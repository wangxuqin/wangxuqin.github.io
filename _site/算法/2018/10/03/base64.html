<!DOCTYPE html>
<html lang="zh">
  <head>

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>base64算法简介 | KimWang's blog</title>
<meta name="description" content="KimWang's blog">

<meta itemprop="name" content="">
<meta itemprop="description" content="KimWang's blog">
<meta itemprop="image" content="">

<meta property="og:url" content="http://localhost:4000/%E7%AE%97%E6%B3%95/2018/10/03/base64.html">
<meta property="og:type" content="website">
<meta property="og:title" content="base64算法简介 | KimWang's blog">
<meta property="og:site_name" content="KimWang's blog">
<meta property="og:description" content="KimWang's blog">
<meta property="og:image" content="">

<meta name="twitter:url" content="http://localhost:4000/%E7%AE%97%E6%B3%95/2018/10/03/base64.html">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="base64算法简介 | KimWang's blog">
<meta name="twitter:site" content="KimWang's blog">
<meta name="twitter:description" content="KimWang's blog">

<meta property="twitter:image" content="">

<link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">

<!--
<link rel="stylesheet" href="/assets/css/app.min.css">
<link rel="alternate" type="application/rss+xml" title="KimWang's blog" href="/feed.xml">
<link rel="canonical" href="/%E7%AE%97%E6%B3%95/2018/10/03/base64.html">
-->

<link rel="stylesheet" href="/assets/dist/style.css">
<link rel="stylesheet" href="/assets/dist/highlight.css">
<link rel="stylesheet" href="/assets/dist/search.css">
<link rel="stylesheet" href="/assets/dist/fontsettings.css">
<link rel="stylesheet" href="/assets/dist/tool.css">




</head>

  <body>
    <div class="book without-animation with-summary font-size-2 font-family-1">
    <input type='checkbox' id='sidemenu' checked="true">
<aside>
<h3>KimWang's blog</h3>
<ul id="sideul">
    <li><a            href="http://localhost:4000/">主页</a></li>
    <li><a class="active" href="http://localhost:4000/posts.html">文章</a></li>
    <li><a  href="http://localhost:4000/tools.html">工具</a></li>
    <li><a href="#">关于</a></li>
</ul> 
</aside>   

<div class="book-summary">
	
  		<nav role="navigation">
  <ul class="summary">
    
    
    <h2>&nbsp;&nbsp;算法</h2>
    
      <li class="active"><a href="/%E7%AE%97%E6%B3%95/2018/10/03/base64.html">&nbsp;&nbsp;&nbsp;&nbsp;1.base64算法简介</a></li>
    
  
  </ul>
</nav>
  	
</div>

<div id='wrap'>
    <label id='sideMenuControl' for='sidemenu'>≡</label>
</div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <div style="display: none">TODO: share icons</div>
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <a>base64算法简介</a>
          </h1>
        </div>
        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">
            <div id="book-search-results">
              <div class="search-noresults">
                <section class="normal markdown-section">
                  <h4 id="定义">定义</h4>
<p>Base64是一种基于64个可打印字符来表示二进制数据的表示方法。</p>

<h4 id="历史">历史</h4>
<p>对于电子邮件网络的最初几十年（1971年至1990年代早期），大多数电子邮件消息都是7位US-ASCII字符集中的纯文本。二进制文件（比如图片）不能通过电子邮件进行传输，例如图片中有一个字节为0xff(即255)超过127，那么这个字节就无法通过邮件进行传输了。<br /></p>

<p>为此便设计出Base64这边编码，目的就是为将二进制数据转换为7位的ASCII字符，Base64使用一组6-bit字节数组代替原来8-bit的二进制字节数组，并将该6-bit数组映射到被选定64个可打印的ASCII码之中，这样原先的二进制数组就变成一个ASCII字符串，从而顺利进行传输。<br /></p>

<p>出于相同目的，还诞生了很多类似的编码，比如：uuencoding，Ascii85，SREC，BinHex，kermit等。<br /></p>

<h4 id="编码算法">编码算法</h4>
<p>假设有一组二进制数组（0xff 0xfe 0xfd 0xfc 0xfb 0xfa…)<br /></p>

<p>步骤1:将数组中每3个字节分为一组比如 (0xff 0xfe 0xfd), (0xfc, 0xfb, 0xfa)…<br /></p>

<p>步骤2:将3个字节共24bit平均分为4个6-bit大小的数字，这里以(0xff 0xfe 0xfd)为例：<br />
(0xff 0xfe 0xfd)即为(11111111, 11111110, 11111101)，进行6-bit分割得(111111|11, 1111|1110, 11|111101)，分割后为(111111, 111111, 111011, 111101)，用10进制表示(63, 63, 59, 61)<br /></p>

<p>步骤3:将步骤2得到的(63, 63, 59, 61)进行查表替换，标准Base64算法的映射表如下所示，得到(/, /, 7, 9)。<br />
<img src="/assets/dist/img/base64_encode_1.png" height="90px" /></p>

<p>步骤4:根据步骤2、3进行剩余数组的编码。</p>

<p>这里还存在一个问题，假如最后一组被分割数组不足3个字节，这时分为两种情况:<br /></p>

<p>1)剩余2个字节:<br />
比如(0xff 0xfe)即为(11111111, 11111110)，进行6-bit分割得到(111111|11, 1111|1110)，这时只能分割为三个部分，且第三部分不足6-bit，需要为其补上2个0，得到(111111, 111111, 111000)， 10进制表示(63, 63, 56)，根据索引值查表得到(/,  /, 4 )，因为只有三个字符，所以还需要为其补充一填充字符=，最后编码为(/, /, 4, =)。<br />
<img src="/assets/dist/img/base64_encode_2.png" height="90px" /></p>

<p>2)剩余1个字节:<br />
比如(0xff)即为(11111111,)，进行6-bit分割得到(111111|11)，这时只能分割为两个部分，且第二部分不足6-bit，需要为其补上4个0，得到(111111, 110000)， 10进制表示(63, 48)，根据索引值查表得到(/,  w)，因为只有两个字符，所以还需要为其补充两个填充字符=，最后编码为(/, w, =, =)。<br />
<img src="/assets/dist/img/base64_encode_3.png" height="90px" /></p>

<p>标准Base64映射表<br />
<img src="/assets/dist/img/base64_table.png" alt="base64_table" /></p>

<h4 id="base64变种">Base64变种</h4>
<p>Base64其实不单单只有一种，为适应更多场景使用，它产生了很多变种，其中第0到第61个映射字符是一样的，不同主要集中在第62、63字符，没有填充字符，是否需要换行以及行长度限制。下面是Base64变种部分汇总表:<br />
<img src="/assets/dist/img/base64_summary_table.png" height="420px" /></p>

<p>说明:</p>

<p>1)目前网上在线Base64编解码绝大多数采用的是RFC4648 Base64，它的特点是第62、63映射字符为’+’， ‘/’，没有行长度限制，不会加入回车换行符。<br /></p>

<p>2)有些编程语言采用MIME Base64方式，这样当编码字符串长度大于76时，就会加上回车换行符，从而该编码字符串被应用到其它地方可能会引发些问题。<br /></p>

<p>3)当URL参数使用Base64进行编码，这时映射字符’+’，’/’， 填充字符’=’，会被转换成”%XX”形式，而这些’%’在存入数据库前还需要进行转换，因为ANSI SQL中已将’%’字符作为通配符。这时可以选择使用Base64url，这种Base64将’+’ ,  ‘/’使用’-‘, ‘_’ 替代，并且不再强制使用填充字符”=”。 <br /></p>

<p>4)在XML中应用Base64可以使用”XML 名称标记(Nmtoken) Base64 “和”XML 标识符(name) Base64”。<br /></p>

<h4 id="常用编程语言">常用编程语言</h4>

<p>1)python3 base64模块</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#导入base64模块</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="n">original</span> <span class="o">=</span> <span class="n">b</span><span class="s">'python3 base64 demo'</span>
<span class="c">#编码</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="c">#解码</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
</code></pre></div></div>

<p>注意：在Python3中，Base64编码仅仅用于面向字节的数据比如字节字符串和字节数组。 此外，编码处理的输出结果总是一个字节字符串。当解码Base64的时候，字节字符串和Unicode文本都可以作为参数。 但是，Unicode字符串只能包含ASCII字符。</p>

<p>如果你想混合使用Base64编码的数据和Unicode文本，你必须添加一个额外的解码步骤。</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">original</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">)</span>
</code></pre></div></div>

<p>2)javascript base64</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">//编码</span>
<span class="kd">function</span> <span class="nx">b64EncodeUnicode</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">btoa</span><span class="p">(</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/%</span><span class="se">([</span><span class="sr">0-9A-F</span><span class="se">]{2})</span><span class="sr">/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">p1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="s1">'0x'</span> <span class="o">+</span> <span class="nx">p1</span><span class="p">);</span>
    <span class="p">}));</span>

<span class="nx">b64EncodeUnicode</span><span class="p">(</span><span class="s1">'✓ à la mode'</span><span class="p">);</span> <span class="c1">// "4pyTIMOgIGxhIG1vZGU="</span>


<span class="c1">//解码</span>
<span class="kd">function</span> <span class="nx">b64DecodeUnicode</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">''</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'%'</span> <span class="o">+</span> <span class="p">(</span><span class="s1">'00'</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">''</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">b64DecodeUnicode</span><span class="p">(</span><span class="s1">'4pyTIMOgIGxhIG1vZGU='</span><span class="p">);</span> <span class="c1">// "✓ à la mode"</span>
<span class="nx">b64DecodeUnicode</span><span class="p">(</span><span class="s1">'Cg=='</span><span class="p">);</span> <span class="c1">// "\n"</span>
</code></pre></div></div>
<p>说明：函数btoa和atob是javascript原生base64编解码接口，由于 DOMString 是16位编码的字符串，所以如果有字符超出了8位ASCII编码的字符范围时，在大多数的浏览器中对Unicode字符串调用 window.btoa 将会造成一个 Character Out Of Range 的异常。所以需要使用encodeURIComponent/decodeURIComponent进行处理。</p>

<p>3)objective-c base64</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//编码</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nf">base64Encode</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">string</span>
<span class="p">{</span>
    <span class="n">NSData</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">string</span> <span class="nf">dataUsingEncoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
    <span class="c1">// option选项：</span>
    <span class="c1">// 默认为0，不换行，结尾为回车换行符</span>
    <span class="c1">// NSDataBase64Encoding64CharacterLineLength 编码行长度限制为64</span>
    <span class="c1">// NSDataBase64Encoding76CharacterLineLength 编码行长度限制为76</span>
    <span class="c1">// NSDataBase64EncodingEndLineWithCarriageReturn 结尾为回车符</span>
    <span class="c1">// NSDataBase64EncodingEndLineWithLineFeed    结尾为换行符</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">data</span> <span class="nf">base64EncodedStringWithOptions</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">//解码</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nf">base64Decode</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">string</span>
<span class="p">{</span>
    <span class="n">NSData</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSData</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">initWithBase64EncodedString</span><span class="p">:</span><span class="n">string</span> <span class="nf">options</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">NSString</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">initWithData</span><span class="p">:</span><span class="n">data</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

                </section>

                <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a>
              </div>
            <div class="search-results">
              <div class="has-results">
                <h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1>
                <ul class="search-results-list"></ul>
              </div>
            <div class="no-results">
              <h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1>
            </div>
            </div>
            </div>
          </div>
        </div>
      </div>


      <!--<a href="rpi3.html" class="navigation navigation-next navigation-unique" aria-label="Next page: 2016 Raspberry Pi Model 3 B" style="margin-right: 0px;">
          <i class="fa fa-angle-right"></i>
      </a>
    </div> -->
</div>

    
  </body>
</html>
